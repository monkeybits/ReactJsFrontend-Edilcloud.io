(self.webpackChunkfuse_react_app=self.webpackChunkfuse_react_app||[]).push([[23035],{88325:function(e,t,n){"use strict";var f=n(97439),d=n(84818),p=n(78709),a=n(16526),y=n(30367),a=n(6274),v=n(92466),h=n(60339),n=p.forwardRef(function(e,t){var n=e.children,a=e.classes,r=e.className,o=e.disableTypography,i=void 0!==o&&o,l=e.inset,c=void 0!==l&&l,s=e.primary,u=e.primaryTypographyProps,m=e.secondary,o=e.secondaryTypographyProps,l=(0,d.Z)(e,["children","classes","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"]),e=p.useContext(h.Z).dense,n=null!=s?s:n;null==n||n.type===v.Z||i||(n=p.createElement(v.Z,(0,f.Z)({variant:e?"body2":"body1",className:a.primary,component:"span",display:"block"},u),n));return null==m||m.type===v.Z||i||(m=p.createElement(v.Z,(0,f.Z)({variant:"body2",className:a.secondary,color:"textSecondary",display:"block"},o),m)),p.createElement("div",(0,f.Z)({className:(0,y.Z)(a.root,r,e&&a.dense,c&&a.inset,n&&m&&a.multiline),ref:t},l),n,m)});t.Z=(0,a.Z)({root:{flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},multiline:{marginTop:6,marginBottom:6},dense:{},inset:{paddingLeft:56},primary:{},secondary:{}},{name:"MuiListItemText"})(n)},23035:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var t=n(79545),V=n.n(t),t=n(68357),Q=n.n(t),t=n(56156),H=n.n(t),t=n(61432),J=n.n(t),t=n(28129),K=n.n(t),ee=n(96569),te=n(25710),ne=n(86926),ae=n(38932),re=n(88325),oe=n(48258),ie=n(41713),le=n(73772),ce=n(96282),se=n(92466),ue=n(13786),me=n(1644),fe=n(65087),de=n(53742),pe=n(82159),ye=n(78709),ve=n(88572),he=n(11208),Ee=n(3089),ge=n(58913),be=n(49073),xe=n(62475),Ze=n(21258),_e=n(3572),we=n(63982),ke=n(53369),t=n(32986);function a(t,e){var n,a=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,n)),a}function Ne(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach(function(e){H()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function Se(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,t=function(){};return{s:t,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw r}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Oe=(0,t.ZP)(function(){return Promise.all([n.e(10930),n.e(25872)]).then(n.bind(n,73430))}),Ce=(0,t.ZP)(function(){return n.e(3587).then(n.bind(n,3587))}),Te=(0,t.ZP)(function(){return n.e(23814).then(n.bind(n,23814))}),De=n(95679);function r(e){var t,u=e.post,a=e.setCommentOpen,n=e.commentBoxOpen,m=e.comment,r=e.isOffline,o=e.callRetryCommentSuccess,i=e.needToGetComments,f=e.tempAuthor,l=e.afterDeleteComment,c=e.nameSpace,s=(0,ke.$)(void 0===c?"todo_project":c).t,d=(0,ge.I0)(),p=(0,ye.useRef)(null),y=(0,ye.useRef)(null),v=ye.useState(!1),h=J()(v,2),E=h[0],g=h[1],b=(0,ye.useState)(null),e=J()(b,2),x=e[0],Z=e[1],c=(0,ye.useState)(""),v=J()(c,2),_=v[0],w=v[1],h=(0,ye.useState)(""),b=J()(h,2),k=b[0],N=b[1],e=(0,ye.useState)(!1),c=J()(e,2),S=c[0],O=c[1],v=(0,ye.useState)(!1),h=J()(v,2),b=h[0],C=h[1],e=(0,ye.useState)(!1),c=J()(e,2),v=c[0],T=c[1],h=(0,ye.useState)([]),e=J()(h,2),D=e[0],P=e[1],c=(0,ye.useState)({}),h=J()(c,2),j=h[0],R=h[1],e=ye.useState(),I=J()(e,2)[1],A=ye.useCallback(function(){return I({})},[]),c=ye.useState(!1),h=J()(c,2),L=h[0],B=h[1],U=(0,ge.v9)(function(e){return e.notificationPanel}),e=ye.useState(null),c=J()(e,2),h=c[0],M=c[1],Y=(0,ye.useRef)(null),z=(null===(e=U.notificationData)||void 0===e||null===(G=e.notification)||void 0===G?void 0:G.object_id)==m.id;(0,ye.useEffect)(function(){var e,t,n;"comment"===(null===(e=U.notificationData)||void 0===e||null===(t=e.notification)||void 0===t?void 0:t.content_type)&&m&&null!==(n=U.notificationData)&&void 0!==n&&n.notification.body.hasOwnProperty("comment_id")&&(null===(n=U.notificationData)||void 0===n?void 0:n.notification.body.comment_id)==m.id&&g(!0)},[U.notificationData,m]),(0,ye.useEffect)(function(){z?setTimeout(function(){B(!0)},300):B(!0)},[m]),(0,ye.useEffect)(function(){return P(m.replies_set),function(){P([])}},[m.replies_set]);c=[{icon:"edit",name:"EDIT",handler:function(){N(m.text),T(!0),M(null)}},{icon:"delete",name:"DELETE",handler:function(e){X(),M(null)}}];(0,ye.useEffect)(function(){var e=null===(e=U.notificationData)||void 0===e?void 0:e.notification;U.viewing&&"comment"==(null==e?void 0:e.content_type)&&L&&Y.current&&(d(we.sM()),Y.current.scrollIntoView(!1),Y.current.classList.add("bg-yellow-200"),setTimeout(function(){Y.current&&Y.current.classList.remove("bg-yellow-200")},5e3))},[U.viewing,Y,L]);function F(e){var t=Ne({},j);delete t[e],R(t),O(!1),q()}function W(){var e;return null==$||null===(e=$.extra)||void 0===e?void 0:e.profile.role}var q=function(t){(0,ve.k)((0,he.fQ)(m.id),{},function(e){P(e.results),t&&t(!1)},function(e){t&&t(!1),console.log(e)},ve.Y.GET,(0,Ee.XW)())},e=function(){var t=Q()(K().mark(function e(t){var n,a,r,o;return K().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.currentTarget.files,a=[],r=0;case 3:if(!(r<n.length)){e.next=26;break}if(o=null===(o=n[r].type)||void 0===o?void 0:o.split("/"),e.t0=[],e.t1=V()(a),"image"==o[0])return e.next=10,(0,Ee.y6)(n[r]);e.next=13;break;case 10:e.t2=e.sent,e.next=14;break;case 13:e.t2=n[r];case 14:e.t3=e.t2,e.t4=URL.createObjectURL(n[r]),e.t5=o[0],e.t6=".".concat(o[1]),e.t7=o.join("/"),e.t8={file:e.t3,imgPath:e.t4,fileType:e.t5,extension:e.t6,type:e.t7},e.t9=[e.t8],a=e.t0.concat.call(e.t0,e.t1,e.t9),Z(a);case 23:r++,e.next=3;break;case 26:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),X=function(e){(0,ve.k)((0,he.Di)(m.id),{},function(e){return l()},function(e){return console.log(e)},ve.Y.DELETE,(0,Ee.XW)())},G=function(){return Object.values(j).length+D.length},$=(Boolean(h),(0,Ee.Fc)());return ye.createElement("div",{key:m.id,ref:(null===(h=U.notificationData)||void 0===h||null===(t=h.notification)||void 0===t?void 0:t.object_id)==m.id?Y:null},ye.createElement(ee.Z,{className:"px-0 items-start"},ye.createElement(te.Z,{alt:m.author.first_name,src:m.author.photo,className:"mr-12 h-48 w-48"},m.author.first_name),v?ye.createElement("div",{className:"flex-1 mx-4"},ye.createElement(ne.Z,{elevation:0,className:"w-full relative post-icons"},ye.createElement(ae.Z,{className:"p-8 w-full border-1",classes:{root:"text-13"},placeholder:s("ADD_COMMENT"),value:k,multiline:!0,rows:"2",margin:"none",disableUnderline:!0,onChange:function(e){return N(e.target.value)}}))):ye.createElement("div",{className:"w-full relative"},ye.createElement(re.Z,{className:"p-10 py-8 m-0 comment-p bg-post-section rounded-16 w-full",primary:ye.createElement("div",{className:"flex comment-section"},ye.createElement("span",{className:"text-15 font-700"},"".concat(m.author.first_name," ").concat(m.author.last_name))),secondary:ye.createElement("div",null,ye.createElement("p",{className:"text-base text-black"},m.text))}),ye.createElement("div",{className:"posted-images comment-post-img"}),f.id==m.author.id&&ye.createElement("div",{className:"actions-dropdown resize-action-btn absolute top-0 right-0"},ye.createElement(Oe,{icon:ye.createElement(ye.Fragment,null,ye.createElement(oe.Z,{"aria-label":"more","aria-controls":"long-menu","aria-haspopup":"true",onClick:function(e){e.preventDefault(),e.stopPropagation(),M(e.currentTarget)},className:"p-10"},ye.createElement(_e.Z,null))),outsideClick:!0},c.map(function(e){return ye.createElement(ie.Z,{key:e.name,onClick:e.handler},ye.createElement(le.Z,null,ye.createElement(ce.Z,null,e.icon)),ye.createElement(se.Z,{variant:"inherit"}," ",s(e.name)))})))),r&&ye.createElement(ye.Fragment,null,m.retryOption&&!b?ye.createElement(ue.Z,{onClick:function(){C(!0),(0,ve.k)((0,he.ns)(u.id),m.formData,function(e){C(!1),o(m.unique_code)},function(e){C(!1)},ve.Y.POST,(0,Ee.XW)())}},s("RETRY")):ye.createElement(me.Z,{position:"relative",display:"inline-flex"},ye.createElement(fe.Z,{size:20,color:"secondary"}),ye.createElement(me.Z,{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},ye.createElement(xe.G,{icon:Ze.cf$,style:{fontSize:"1.5rem"}}))))),!r&&v&&"w"!=W()?ye.createElement("div",{className:"flex flex-wrap items-center ml-60"},ye.createElement(ue.Z,{className:"mx-2",variant:"contained",onClick:function(){return T(!1)},size:"small"},ye.createElement(se.Z,{className:"normal-case mx-4"},s("CANCEL"))),ye.createElement(ue.Z,{disabled:!k.length,onClick:function(){var e,t=new FormData,n={text:k};for(e in n)t.append(e,n[e]);(0,ve.k)((0,he.rZ)(m.id),t,function(e){console.log("edited",e),i(T)},function(e){},ve.Y.PUT,(0,Ee.XW)())},className:"mx-2",variant:"contained",size:"small",color:"secondary"},ye.createElement(se.Z,{className:"normal-case mx-4"},s("SAVE")))):ye.createElement("div",{className:"flex flex-wrap items-center ml-60"},ye.createElement(ue.Z,{disabled:"w"==W(),onClick:function(){a(!n),"w"!=W()&&(O(function(e){return!e}),w("@"+"".concat(m.author.first_name," ").concat(m.author.last_name)),setTimeout(function(){var e,t;S||(e="@"+"".concat(m.author.first_name," ").concat(m.author.last_name),(t=document.getElementById(String(m.id))).selectionStart=e.length,t.selectionEnd=e.length,t.focus())},100))},size:"small"},ye.createElement(ce.Z,{className:"text-13",color:"action"},"reply_outlined"),ye.createElement(se.Z,{className:"normal-case text-13 ml-4"},s("REPLY"))),ye.createElement("div",{className:"flex items-center ml-auto cursor-pointer ".concat(G()?" text-blue-500":""),onClick:function(e){e.preventDefault(),e.stopPropagation(),g(!E),a(!1)}},ye.createElement(se.Z,{className:"underline font-600 text-13"},G()," ",s("REPLIES")),ye.createElement(ce.Z,{className:"font-600 text-16 ml-2",color:"action"},E?"keyboard_arrow_down":"keyboard_arrow_right"))),(Object.values(j).length||0<D.length)&&ye.createElement(de.Z,{in:E,timeout:"auto",unmountOnExit:!0},ye.createElement("div",{className:"left-100"},ye.createElement(pe.Z,{className:"clearfix"},D.map(function(n,e){return ye.createElement(Ce,{tempAuthor:f,commentId:m.id,author:m.author,key:e,post:u,comment:n,getReplies:q,afterDeleteComment:function(){return n=e,P(function(e){return e.filter(function(e,t){return t!=n})});var n},handleReplyClick:function(){S?(O(!1),w("")):(O(!0),a(!1),w("@"+"".concat(n.author.first_name," ").concat(n.author.last_name)),setTimeout(function(){var e="@"+"".concat(n.author.first_name," ").concat(n.author.last_name),t=document.getElementById(String(m.id));t.selectionStart=e.length,t.selectionEnd=e.length,t.focus()},100))}})}),Object.values(j).map(function(n,e){var t;return ye.createElement(Ce,(t={isOffline:!0,tempAuthor:f,key:n.unique_code,callRetryReplySuccess:F,commentId:m.id,author:f},H()(t,"key",e),H()(t,"post",u),H()(t,"comment",n),H()(t,"getReplies",q),H()(t,"handleReplyClick",function(){S?(O(!1),w("")):(O(!0),a(!1),w("@"+"".concat(n.author.first_name," ").concat(n.author.last_name)),setTimeout(function(){var e="@"+"".concat(n.author.first_name," ").concat(n.author.last_name),t=document.getElementById(String(m.id));t.selectionStart=e.length,t.selectionEnd=e.length,t.focus()},100))}),t))})))),S&&ye.createElement("div",{className:"flex-1 left-100 my-6"},ye.createElement(ne.Z,{elevation:0,className:"w-full relative post-icons rounded-32"},ye.createElement(ae.Z,{ref:y,className:"pl-12 pr-80 py-8 w-full border-1 comment-area",id:String(m.id),classes:{root:"text-base"},placeholder:s("ADD_COMMENT"),value:_,multiline:!0,disableUnderline:!0,onChange:function(e){return w(e.target.value)}}),ye.createElement(oe.Z,{className:"image p-0",onClick:function(){return p.current.click()},"aria-label":"Add photo"},ye.createElement(ce.Z,null,"photo")),ye.createElement("input",{hidden:!0,type:"file",accept:"image/*, video/*",ref:p,onChange:e}),ye.createElement(oe.Z,{className:"send p-0",onClick:function(e){if(e.preventDefault(),_||null!=x&&x.length){var t=De(),e=[];x&&(e=x.map(function(e){return{extension:e.extension,media_url:e.imgPath,name:e.file.name,type:e.type}}));var n=new FormData;n.append("parent","");var a,r={text:_,parent:m.id,unique_code:t};if(x){var o,i=0,l=Se(x.map(function(e){return e.file}));try{for(l.s();!(o=l.n()).done;){var c=o.value;n.append("media[".concat(i,"]"),c,c.name),i+=1}}catch(e){l.e(e)}finally{l.f()}}for(a in r)n.append(a,r[a]);var e={author:f,replies_set:[],media_set:e,text:_,unique_code:t,parent:null,formData:n},s=Ne(Ne({},j),{},H()({},t,e));R(s),(0,ve.k)((0,he.ns)(u.id),n,function(e){delete s[e.unique_code],R(s),q(),O(!1)},function(e){s[t]=Ne(Ne({},s[t]),{},{retryOption:!0}),console.log({myErrorComment:e,tempofflineCommentReplies:s}),R(s),A()},ve.Y.POST,(0,Ee.XW)()),Z(null),w(""),document.getElementById(String(m.id)).value=""}},"aria-label":"Send",disabled:!_&&!x},ye.createElement(ce.Z,null,"send"))),x&&ye.createElement(Te,{images:x,replaceUrl:function(e,t){x[t]=Ne(Ne({},x[t]),{},{imgPath:e,file:be.Z.dataURItoFile(e)}),Z(x)}})))}}}]);