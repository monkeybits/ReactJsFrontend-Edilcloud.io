(self.webpackChunkfuse_react_app=self.webpackChunkfuse_react_app||[]).push([[52624],{52624:function(e,t,n){"use strict";n.r(t);var o=n(51265),U=n.n(o),o=n(68357),T=n.n(o),o=n(61432),R=n.n(o),o=n(56156),D=n.n(o),o=n(79545),C=n.n(o),o=n(28129),M=n.n(o),z=n(94678),B=n(38932),L=n(84403),W=n(48258),X=n(96282),H=n(50390),q=n(41713),G=n(73772),V=n(92466),Y=n(13786),$=n(29796),o=n(32986),K=n(78709),Q=n(88572),ee=n(11208),te=n(3089),ne=n(58913),oe=n(10588),re=n(49073),ae=n(49607),le=n(53369),ie=n(7074),se=n(8662);function ce(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,t=function(){};return{s:t,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw r}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function r(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function ue(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach(function(e){D()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var fe=(0,o.ZP)(function(){return n.e(23814).then(n.bind(n,23814))}),me=(0,o.ZP)(function(){return n.e(47553).then(n.bind(n,47553))}),de=(0,o.ZP)(function(){return Promise.all([n.e(10930),n.e(25872)]).then(n.bind(n,73430))}),pe=n(95679);t.default=function(e){var m=e.isTask,d=e.taskId,t=(0,le.$)("dashboard").t,p=(0,ne.I0)(),n=K.useState(),o=R()(n,2)[1],g=K.useCallback(function(){return o({})},[]),r=(0,ne.v9)(function(e){return e.auth.user.data.company}),a=(0,K.useState)({}),y=(c=R()(a,2))[0],l=c[1],i=(0,K.useState)({posts:[]}),e=(N=R()(i,2))[0],s=N[1],n=(0,K.useState)({files:[]}),c=(a=R()(n,2))[0],u=a[1],i=(0,K.useState)({}),h=(N=R()(i,2))[0],v=N[1],n=(0,K.useState)(""),b=(a=R()(n,2))[0],f=a[1],i=(0,K.useState)(null),S=(N=R()(i,2))[0],x=N[1],n=(0,K.useState)(!1),i=((a=R()(n,2))[0],a[1],(0,K.useState)(!1)),n=(N=R()(i,2))[0],O=N[1],a=(0,K.useState)(!0),w=(i=R()(a,2))[0],E=i[1],N=[{icon:"public",name:"Public",handler:function(){E(!0)}},{icon:"lock",name:"Private",handler:function(e){E(!1)}}],a=(0,K.useState)({fileData:void 0,imagePreviewUrl:void 0}),k=((i=R()(a,2))[0],i[1]),P=((0,K.useRef)(null),(0,ne.v9)(function(e){return e.todoApp.todos.todoDialog})),j=(0,te.Fc)();function _(){try{window.webkit.messageHandlers&&window.webkit.messageHandlers.UploadImage.postMessage("Start Image Loading")}catch(e){console.log("error",e)}}(0,K.useEffect)(function(){window.updateImage=A},[]),(0,K.useEffect)(function(){r&&l(ue({},r))},[r]),(0,K.useEffect)(function(){var e;s({posts:[]}),null!==(e=P.data)&&void 0!==e&&(null!==(e=e.todo)&&void 0!==e&&e.id)&&Z()},[P.data]),(0,K.useEffect)(function(){m&&(s({posts:[]}),I(),Z())},[m,d]);var F,Z=function(){var e;O(!0),(0,Q.k)(m?(0,ee.ri)(d):(0,ee._j)(null===(e=P.data.todo)||void 0===e?void 0:e.id),{},function(e){O(!1),s({posts:e.results});e=e.results,e=Array.isArray(e)&&e.length?(console.log({timeline:e}),e.reduce(function(e,t){return{media_set:[].concat(C()(e.media_set),C()(t.media_set)).map(function(e,t){return ue(ue({},e),{},{index:t})})}},{media_set:[]})):{media_set:[]};u({files:e.media_set})},function(e){O(!1),console.log(e)},Q.Y.GET,(0,te.XW)())},a=function(){var e=T()(M().mark(function e(){var t,n,o,r,a,l,i,s,c,u,f;return M().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new FormData,n=pe(),o={text:b,unique_code:n,is_public:w},r=[],S&&(r=S.map(function(e){return{extension:e.extension,media_url:e.imgPath,name:e.file.name,type:e.type}})),S){u=S.map(function(e){return e.file}),a=0,l=ce(u);try{for(l.s();!(i=l.n()).done;)s=i.value,t.append("media[".concat(a,"]"),s,s.name),a+=1}catch(e){l.e(e)}finally{l.f()}}for(c in o)o[c]&&t.append(c,o[c]);u={formData:t,text:b,author:y,media_set:r,unique_code:n},console.log("media_set",JSON.stringify(r)),f=ue(ue({},h),{},D()({},n,u)),v(f),p(ie.VX(!0)),(0,Q.k)(m?(0,ee.NP)(d):(0,ee.AY)(null===(u=P.data.todo)||void 0===u?void 0:u.id),t,function(e){p(ie.VX(!1)),console.log("res",JSON.stringify(e)),delete f[e.unique_code],v(f),Z()},function(e){p(ie.VX(!1)),f[n]=ue(ue({},f[n]),{},{retryOption:!0}),console.log("err",JSON.stringify(e)),console.log("tempOfflinePosts",JSON.stringify(f)),v(f),g()},Q.Y.POST,ue(ue({},(0,te.XW)()),{},{onUploadProgress:function(e){e=Math.round(100*e.loaded/e.total);p(ie.iw(e))}})),document.getElementById("addPost").value="",x(null);case 15:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),A=function(){var t=T()(M().mark(function e(t){var n,o,r,a,l,i,s,c,u,f,m,d;return M().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=[],o={"image/jpeg":".jpg","image/png":".png","application/pdf":".pdf","application/json":".json","application/vnd.ms-excel":".xls","text/csv":".csv","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":".xlsx","audio/mp4":".mp4a","video/mp4":".mp4","application/mp4":".mp4"},r="",a=0;a<8;a++)l=Math.floor(27*Math.random()),r+=String.fromCharCode(97+l);i=t.substr(0,t.indexOf(";")),i=i.split(":")[1],i=J(t,r+o[i]),console.log("file???????????????????????",i),n.push(i),i=n[0],console.log("File size ".concat(i.size/1024/1024," MB")),console.log("File Index 0",JSON.stringify(i));try{for("image"==(null===(s=i.type)||void 0===s?void 0:s.split("/")[0])?(c=i,console.log("with compressedFile(blob)",JSON.stringify(c)),console.log("compressedFile into the file",JSON.stringify(new File([c],c.name))),console.log("compressedFile instanceof Blob",JSON.stringify(c instanceof Blob)),console.log("compressedFile size ".concat(c.size/1024/1024," MB")),k({fileData:new File([c],c.name)})):k({fileData:i}),u=[],f=0;f<n.length;f++)d=null===(m=n[f].type)||void 0===m?void 0:m.split("/"),console.log("file",JSON.stringify(n[f])),console.log("fileType",JSON.stringify(d)),console.log("local url",JSON.stringify(URL.createObjectURL(n[f]))),u=[].concat(C()(u),[{file:(d[0],n[f]),imgPath:URL.createObjectURL(n[f]),fileType:d[0],extension:".".concat(d[1]),type:d.join("/")}]),x(u)}catch(e){console.log("Error",e)}case 14:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),J=function(e,t){for(var n=e.split(","),e=n[0].match(/:(.*?);/)[1],o=atob(n[1]),r=o.length,a=new Uint8Array(r);r--;)a[r]=o.charCodeAt(r);return new File([a],t,{type:e})},i=function(){var t=T()(M().mark(function e(t){var n,o,r,a,l;return M().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("files???????????????????",t),n=t[0],console.log("File size ".concat(n.size/1024/1024," MB")),console.log("File Index 0",JSON.stringify(n)),"image"==(null===(o=n.type)||void 0===o?void 0:o.split("/")[0]))return e.next=7,(0,oe.Z)(n,{maxSizeMB:.1,maxWidthOrHeight:1024,useWebWorker:!0});e.next=15;break;case 7:o=e.sent,console.log("with compressedFile(blob)",JSON.stringify(o)),console.log("compressedFile into the file",JSON.stringify(new File([o],o.name))),console.log("compressedFile instanceof Blob",JSON.stringify(o instanceof Blob)),console.log("compressedFile size ".concat(o.size/1024/1024," MB")),k({fileData:new File([o],o.name)}),e.next=16;break;case 15:k({fileData:n});case 16:r=[],a=0;case 18:if(!(a<t.length)){e.next=44;break}if(l=null===(l=t[a].type)||void 0===l?void 0:l.split("/"),console.log("file",JSON.stringify(t[a])),console.log("fileType",JSON.stringify(l)),console.log("local url",JSON.stringify(URL.createObjectURL(t[a]))),e.t0=[],e.t1=C()(r),"image"==l[0])return e.next=28,(0,te.y6)(t[a]);e.next=31;break;case 28:e.t2=e.sent,e.next=32;break;case 31:e.t2=t[a];case 32:e.t3=e.t2,e.t4=URL.createObjectURL(t[a]),e.t5=l[0],e.t6=".".concat(l[1]),e.t7=l.join("/"),e.t8={file:e.t3,imgPath:e.t4,fileType:e.t5,extension:e.t6,type:e.t7},e.t9=[e.t8],r=e.t0.concat.call(e.t0,e.t1,e.t9),x(r);case 41:a++,e.next=18;break;case 44:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),I=function(){};return e?K.createElement("div",{className:"md:flex max-w-2xl"},K.createElement("div",{className:"flex flex-col flex-1"},"w"!=(null==j||null===(F=j.extra)||void 0===F?void 0:F.profile.role)&&K.createElement("div",null,K.createElement(z.Z,{className:"w-full overflow-hidden mb-20 post-card-clx"},K.createElement(B.Z,{id:"addPost",className:"p-16 w-full write-post",classes:{root:"text-14"},placeholder:t("WRITE_SOMETHING"),multiline:!0,rows:"3",margin:"none",disableUnderline:!0,onChange:function(e){return f(e.target.value)}}),S&&K.createElement(fe,{key:null!==S?S.length:0,images:S,replaceUrl:function(e,t){S[t]=ue(ue({},S[t]),{},{imgPath:e,file:re.Z.dataURItoFile(e)}),x(S)}}),K.createElement(L.Z,{className:"card-footer flex flex-row border-t-1 items-center justify-between pt-8 pb-6 pr-12 pl-10",position:"static",color:"default",elevation:0,key:"app_".concat(S?S.length:0)},K.createElement("div",{className:"add-photo-image flex"},K.createElement(ae.Z,{onDrop:i},function(e){var t=e.getRootProps,e=e.getInputProps;return K.createElement("section",null,K.createElement("div",t(),K.createElement(W.Z,{onClick:_,"aria-label":"Add photo",className:"p-8"},K.createElement(X.Z,null,"add_a_photo")),K.createElement("input",U()({},e(),{multiple:!0,hidden:!0,type:"file",accept:"image/*, video/*"}))))}),K.createElement(de,{icon:K.createElement(K.Fragment,null,K.createElement(H.Z,{id:"demo-simple-select-label",className:"p-8 border-2 mx-8"},w?"Public":"Private",K.createElement("span",{className:"arrow-icon"}," ",K.createElement(se.Z,null)," ")," ")),outsideClick:!0},N.map(function(e){return K.createElement(q.Z,{key:e.name,selected:"Pyxis"===e.name,onClick:e.handler},K.createElement(G.Z,null,K.createElement(X.Z,null,e.icon)),K.createElement(V.Z,{variant:"inherit"}," ",t(e.name)))}))),K.createElement(Y.Z,{onClick:a,variant:"contained",color:"primary",size:"small","aria-label":"post",disabled:!(b.length||null!=S&&S.length)},t("POST"))))),n&&K.createElement("div",{className:"flex flex-1 flex-col items-center justify-center"},K.createElement(V.Z,{style:{height:"auto"},className:"text-20 mb-16",color:"textSecondary"},"Sto caricando i posts"),K.createElement($.Z,{className:"w-xs",color:"secondary"})),K.createElement(me,{isOffline:!0,tempAuthor:y,isTask:m,taskId:d,posts:Object.values(h),callRetryAfterSuccess:function(e,t){var n=ue({},h);n[e]=ue(ue(ue({},n[e]),t),{},{retryOption:!1,successAfterRetry:!0}),v(n),g()},nameSpace:"dashboard"}),0<e.posts.length?K.createElement(me,{isTask:m,tempAuthor:y,posts:e.posts,media:c.files,nameSpace:"dashboard"}):K.createElement("div",{className:"flex flex-col items-center justify-center"},K.createElement("div",{className:"h-full"},K.createElement("img",{className:"w-400",src:"assets/images/errors/nofiles.png"})),K.createElement("div",{className:"h-full"},K.createElement(V.Z,{color:"textSecondary",variant:"h5"},t("NO_POSTS_MESSAGE")))),K.createElement(me,{isTask:m,tempAuthor:y,posts:e.sharedPosts,nameSpace:"dashboard"}))):null}}}]);